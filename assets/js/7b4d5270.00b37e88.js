"use strict";(self.webpackChunksubnet=self.webpackChunksubnet||[]).push([[7427],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,i=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),c=u(n),h=s,m=c["".concat(l,".").concat(h)]||c[h]||p[h]||i;return n?a.createElement(m,r(r({ref:t},d),{},{components:n})):a.createElement(m,r({ref:t},d))}));function h(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var i=n.length,r=new Array(i);r[0]=c;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:s,r[1]=o;for(var u=2;u<i;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},1361:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var a=n(3117),s=(n(7294),n(3905));const i={id:"design",title:"Status Updates Design",sidebar_label:"Design"},r=void 0,o={unversionedId:"features/status_updates/design",id:"version-0.1.0/features/status_updates/design",title:"Status Updates Design",description:"Intro - Status Updates, Channels, Feeds",source:"@site/versioned_docs/version-0.1.0/features/status_updates/design.md",sourceDirName:"features/status_updates",slug:"/features/status_updates/design",permalink:"/docs/features/status_updates/design",draft:!1,editUrl:"https://github.com/upstter/versioned_docs/version-0.1.0/features/status_updates/design.md",tags:[],version:"0.1.0",lastUpdatedBy:"Aviv Eyal",lastUpdatedAt:1660422095,formattedLastUpdatedAt:"Aug 13, 2022",frontMatter:{id:"design",title:"Status Updates Design",sidebar_label:"Design"},sidebar:"version-0.1.0/someSidebar",previous:{title:"Design Goals",permalink:"/docs/features/status_updates/goals"},next:{title:"Design Goals",permalink:"/docs/features/paid_content/goals"}},l={},u=[{value:"Intro - Status Updates, Channels, Feeds",id:"intro---status-updates-channels-feeds",level:2},{value:"Intro - Replies and Conversations",id:"intro---replies-and-conversations",level:2},{value:"Terminology",id:"terminology",level:3},{value:"Channel Creation and Subscription",id:"channel-creation-and-subscription",level:2},{value:"Entities",id:"entities",level:3},{value:"Creating a New Channel",id:"creating-a-new-channel",level:3},{value:"Channel Bundle and Channel Data",id:"channel-bundle-and-channel-data",level:4},{value:"Status Update Publishing",id:"status-update-publishing",level:2},{value:"Publishing a Reply to a Status Update",id:"publishing-a-reply-to-a-status-update",level:2},{value:"Premium Content Items Publishing via Channels",id:"premium-content-items-publishing-via-channels",level:2},{value:"Status Update Channels Discovery",id:"status-update-channels-discovery",level:2},{value:"Preliminaries",id:"preliminaries",level:3},{value:"Receiving Status Updates",id:"receiving-status-updates",level:2}],d={toc:u};function p(e){let{components:t,...n}=e;return(0,s.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"intro---status-updates-channels-feeds"},"Intro - Status Updates, Channels, Feeds"),(0,s.kt)("p",null,"Status updates are shared by users in status updates ",(0,s.kt)("inlineCode",{parentName:"p"},"channels"),". To publish a ",(0,s.kt)("inlineCode",{parentName:"p"},"status update"),", the user's client first creates a status updates channel. Channels are an abstraction that gives context for status updates."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"You can think about Twitter as a publishing system network each user account can publish only one channel. So channels in Twitter are implicit and have 1:1 relationships with accounts.")),(0,s.kt)("p",null,"When a user decides he wants to publish status updates, he's prompted to create a channel. More advanced users can create multiple channels. For most novice users, one channel is sufficient to publish updates to others."),(0,s.kt)("p",null,"User can name his channel without any limitations, so the channel's name doesn't not necessarily personally identity the user unless he decides he wants to be personally identified (unlike systems like Twitter where all channels are personally identifiable by the company which runs the network)."),(0,s.kt)("p",null,"To receive status updates from a user, another user needs to explicitly subscribe to one of the user's published channels. When a user subscribes to a status update channel, his client creates a ",(0,s.kt)("inlineCode",{parentName:"p"},"feed")," that receives all updates posted on that channel."),(0,s.kt)("p",null,"User may add add additional status updates channels or groups to any of his feed in order to receive status updates and group messages from multiple sources in one context. This makes it easier to consume content than having to browse multiple content streams. Status update publishers have no notion of feeds. They only know about subscribers to their update channels and groups and their clients publish updates in the context of a channel."),(0,s.kt)("p",null,"The user which creates a channel, becomes its super-admin and has full total control over the channel's meta-data, content and configuration."),(0,s.kt)("p",null,"Service providers are responsible to route status updates messages between clients. All of the messages involved in status updates are encrypted, are similar to 1:1 messages exchanged between clients, and provide forward and backward secrecy and some anonymity.  Providers do not have access to a channel's content, meta-data or subscribers list."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"Channels and feeds are built on top of the platform's secure 1:1 messaging capabilities and use similar delivery mechanisms as 1:1 user messages. Unlike other social media platforms, even those that provide end-to-end encryption for 1:1 messaging, there is no compromise of privacy or security when users communicate via status feeds or groups.")),(0,s.kt)("h2",{id:"intro---replies-and-conversations"},"Intro - Replies and Conversations"),(0,s.kt)("p",null,"Any user who receives a status update in a channel from another user may reply to that update. The reply will be viewable by other users who are subscribed to the status updates channel."),(0,s.kt)("p",null,"Users can also reply to any existing reply, thereby creating a threaded conversation in the context of a status update."),(0,s.kt)("p",null,"A status update channel creator can ban any other entity from replying to his status updates or to other replies. Channel creator may also remove a reply author from the channel at his sole discretion."),(0,s.kt)("p",null,"Channel creator can also remove replies from the channel at any time."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"the  policy of what content is an acceptable reply to a channel and who can do it is totally up to the channel's publisher.")),(0,s.kt)("p",null,"If a user's replies are getting deleted they can start their own channel and post their thoughts and opinions there. ",(0,s.kt)("strong",{parentName:"p"},"This is a key product feature as part of pushing moderation to the edge and decentralizing it"),"."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"It is our strongly held opinion that it is not the job of service providers or anyone else to monitor content in a channel and to decide what is acceptable content and what is not. This is the channel's creator role. In addition, channel creator may assign other users to have admin rights and moderate a channel he's created. This is important to ensure that channels with lots of content are properly moderated.")),(0,s.kt)("p",null,"The main disadvantage of the status updates design is that replies to updates (or to other replies) are only sent to subscribers when the channel creator's client comes online. If his client is offline for a long period of time then these replies won't get published. This is needed to ensure privacy, authenticity and security of replies. We believe the pros outweigh the cons in this tradeoffs. e.g. no server-hosted subscribers list, high-degree of encryption for status updates (they are encrypted per receiver using a double ratchet for forward and back secrecy, etc...). It is a reasonable expectation that active users will run their client at least once a day."),(0,s.kt)("hr",null),(0,s.kt)("h3",{id:"terminology"},"Terminology"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"Status Channel")," - What a user creates to share public status updates with others."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"Status Updates")," - Content shared by channel creator to a public status channel."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"Status Channel Subscription")," - A subscription by a user to receive updates posted to the channel. A subscription to a channel creates a feed for the subscriber."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"Status Feed")," - A subscription to a public status channel by a user. Clients subscribe to channels to get a feed of posts in his client app. Users can also create a feed that combines public (and private) status updates published on multiple channels."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"Reply")," - a reply is content published by a user in response to a specific status update or to another reply to a status update. Replies enable threaded discussion about any status update.")),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"channel-creation-and-subscription"},"Channel Creation and Subscription"),(0,s.kt)("h3",{id:"entities"},"Entities"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"User A")," - Alice."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"User B")," - Bob."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"A")," - Alice's client app."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"B")," - Bob's client app.")),(0,s.kt)("img",{style:{backgroundColor:"white"},src:"/seqs/channel_creation.sequence.svg"}),(0,s.kt)("h3",{id:"creating-a-new-channel"},"Creating a New Channel"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"User A")," creates a new ",(0,s.kt)("inlineCode",{parentName:"p"},"status channel")," with an optional ",(0,s.kt)("inlineCode",{parentName:"p"},"display name"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"profile image")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"description"),". Channel is backed by a new cryptographic identity (public and private keys) so the channel id is the identity's account address. The channel information such as its unique id and name are signed by A in a ",(0,s.kt)("inlineCode",{parentName:"p"},"channel bundle"),"."),(0,s.kt)("hr",null),(0,s.kt)("h4",{id:"channel-bundle-and-channel-data"},"Channel Bundle and Channel Data"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-protobuf"},"// A signed immutable bundle describing a status updates channel or a group channel.\n// Designed to be made available for subscribers who have obtained channel_id.\n// Signed by channel id and user to ensure that no-one else can create a channel with the same channel id\nmessage ChannelBundle {\n    EntityId channel_id = 1; // Channel public key id\n    EntityId creator_id = 2; // Channel public key id\n    ChannelType channel_type = 3; // status feed or group\n    uint64 created = 4; // channel creation time\n    string description = 5; // channel desc\n    string acceptable_content_policy = 6; // creator stated acceptable content and moderation policy\n    MediaContent logo = 7; // channel logo (optional)\n    Address payable_address = 8; // account-payable for channel related users fees (paid content, subs, etc...)\n    uint64 subscription_fee = 9; // Optional required monthly subscription fee for a status update channel\n    Signature signature = 10; // signature of channel_id on all above fields- proves user has private key to channel id\n    Signature creator_signature = 11; // channels' client signature on all other fields (including channel signature)\n}\n\n// Private data stored on publisher's client with mutable channel's or group's state.\n// Channel can be public or private, status update channel or a group channel\nmessage ChannelData {\n    ChannelBundle bundle = 1; // current channel bundle and its data\n    bool discoverable = 2; // when true, should be discoverable to anyone given client id\n    uint64 last_updated = 3; // time of last content update\n    repeated EntityId blocked_repliers = 5; // Users blocked by publisher from replying to status updates or group messages.\n    repeated ContentItem content_items = 6; // all channel content item (including replies by other non-blocked subscribers).\n    // Note: this needs to be indexed by item id and by reply_to in order to support threaded discussions and time-based fetch.\n    repeated ChannelSubscribeRequest sub_requests = 7; // pending requests for subscription or membership\n    repeated ChannelSubscriber member = 8; // subscribers for status updates\n    repeated GroupMembersBundle group_members = 9; // members if channel is a group\n}\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-protobuf"},"// A channel member\nmessage ChannelSubscriber {\n    EntityId user_id = 1;\n    uint64 date_subscribed = 2;\n    uint64 time_next_payment_due = 3;\n    // add receipts here for past payments\n}\n\n// A public or private status update, or a group message\nmessage ContentItem {\n    uint64 created = 1; // authoring time-stamp\n    bytes channel_id = 2; // item's channel\n    EntityId author = 3; // item's author\n    uint64 post_id = 4; // unique post id\n    uint64 price = 5; // price for a paid content item. 0 otherwise\n    repeated MediaContent content = 6; // actual content (multi-part, multi-mime)\n    bytes reply_item = 7; // can be a reply to another item\n    Signature signature = 8; // on all of the above data by item's author\n}\n\n//////////////\n\n//////// Channels client to client protocol\n//////// Messages requests and responses from client to client regarding channels\n\n// Request to subscribe to a channel or a group\n// Note that there's not need to sign as app-level protocol messages are always delivered as a signed TypedMessage\nmessage ChannelSubscribeRequest {\n    uint64 time_stamp = 1;\n    bytes channel_id = 2;\n    EntityId user = 3;\n    string message = 4; // short request message. e.g. Hi, this is foo - we talked on...\n    // todo: add payment receipt if channels is paid channel\n    GroupMemberBundle membership = 5; // empty for status updates channel. // For groups - subscriber adds signed membership bundle used by group creator\n}\n\nmessage ChannelSubscribeResponse {\n    bool subscribed = 1; // confirmation\n    string reason = 2; // rejection message or welcome message\n}\n\nmessage CancelChannelSubscription{\n    uint64 time_stamp = 1;\n    bytes channel_id = 2;\n    EntityId user = 3;\n    string message = 4; // short request message. e.g. Hi, this is foo - we talked on...\n    // todo: add payment receipt if channels is paid channel\n}\n\nmessage CancelChannelSubscriptionResponse {\n}\n\n// New channel message\n// Sent from channel creator to all status updates subscribers (or for a group, to group members)\nmessage NewChannelMessage {\n    ContentItem content_item = 1;\n}\n")),(0,s.kt)("p",null,"?> It is 100% up to the user to share personal information in the channel's display name or description or via his friendly nickname advertised via X2DH. For example, a user can choose not to share any such personal information. So, the decision to be anonymous is left to the user and is not in the hands of the service provider."),(0,s.kt)("p",null,"?> Note that unlike Twitter, each human or AI user (who runs and controls A) may publish more than one public feed so they can represent themselves differently to different communities. For example, A may be a DJ but also a software developer. He may chose to share music related updates in his DJ feed and software related updates in a software feed. B might be interested in A's music updates but not in his musings on software... A's user may or may not associate any personally identifying information with these feeds."),(0,s.kt)("p",null,"?> Note that there's a built-in support for premium channels which require monthly subscription fee from subscribers. The platform also supports premium pay-per-content model for premium content shared via a channel."),(0,s.kt)("p",null,"?> Note that channel bundles support both groups and status updates scenarios."),(0,s.kt)("hr",null),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"User A")," can now share the channel public id and some information about it in any medium, for example, he may send the id to another user or share it on legacy social media platforms."),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"User A")," can set the channel to be discoverable to anyone who knows A user id. In this case, it sends the signed channel bundle to ",(0,s.kt)("inlineCode",{parentName:"p"},"SA")," for indexing and ",(0,s.kt)("inlineCode",{parentName:"p"},"SA")," will return the channel bundle for queries for discoverable channels by user a sent to it from other nodes or clients on the network. In this case, ",(0,s.kt)("inlineCode",{parentName:"p"},"User B")," can query ",(0,s.kt)("inlineCode",{parentName:"p"},"SA")," for the name and channel id of discoverable channels published by ",(0,s.kt)("inlineCode",{parentName:"p"},"User A"),"."),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"User B")," obtains ",(0,s.kt)("inlineCode",{parentName:"p"},"channel_id")," via any medium and subscribes to the channel. B sends a ",(0,s.kt)("inlineCode",{parentName:"p"},"Subscribe")," message to A. If the channel requires a monthly subscription fee then B makes a payment and adds the receipt as data to this call."),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"A")," receives the subscription request and, verifies it and adds B to the subscription request list. ",(0,s.kt)("inlineCode",{parentName:"p"},"A")," maintains a data structure for the channel."),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"User A")," approves the subscription request. He can also set A to auto-approve any such request automatically on its behalf. ",(0,s.kt)("inlineCode",{parentName:"p"},"A")," adds ",(0,s.kt)("inlineCode",{parentName:"p"},"B")," to the subscribers list in its channel's data set."),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"A")," sends to ",(0,s.kt)("inlineCode",{parentName:"p"},"B")," a subscription confirmation message."),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"B")," notifies it user ",(0,s.kt)("inlineCode",{parentName:"p"},"User B")," about the subscription."),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"status-update-publishing"},"Status Update Publishing"),(0,s.kt)("img",{style:{backgroundColor:"white"},src:"/seqs/publish_update.sequence.svg"}),(0,s.kt)("p",null,"User A authors a status update in channel c, on A.\nFor each subscriber B to channel c, A validates subscription is valid (for example, B may have not pay a monthly subscription fee) and sends the update to each valid subscriber B."),(0,s.kt)("p",null,"?> This is a high-level flow, lower-level details are that the update is sent to B via SB using the core messaging algorithm. Note that each update is encrypted using forward secrecy in a double ratchet session between A and B and SA and SB can't read the content of the update or even tell it is a status update in channel c. From a messaging perspective, the update looks like any other message from A to B. SA knows A wants to send SB a message but not B's identity. SB knows that A wants to send a message to B but not the content of the message or the channel id or other meta-data."),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"publishing-a-reply-to-a-status-update"},"Publishing a Reply to a Status Update"),(0,s.kt)("img",{style:{backgroundColor:"white"},src:"/seqs/reply_to_update.sequence.svg"}),(0,s.kt)("p",null,"B has a status update or a replay to a status update the User B is viewing. User B decides to reply to the update or the the reply."),(0,s.kt)("p",null,"User B submits the reply content to B. e.g. he enters reply's text."),(0,s.kt)("p",null,"B sends the reply to A using ",(0,s.kt)("inlineCode",{parentName:"p"},"SendReply"),". It provides the channel id and the content item that his reply is about."),(0,s.kt)("p",null,"?> The ",(0,s.kt)("inlineCode",{parentName:"p"},"SendReply")," message is sent using the core messaging algorithm between two clients."),(0,s.kt)("p",null,"A validates the reply. e.g. it checks the B is subscribed to channel c and that that User A didn't block B from posting replies to the channel. A stores the reply in the channel's data."),(0,s.kt)("p",null,"For each channel subscriber C, A sends the reply to C using the platform's core messaging protocol in a similar way to the way it sends a new status update from User A to all subscribers."),(0,s.kt)("p",null,"?> Note that the reply is encrypted using DR between A and every recipient and is protected forward secrecy."),(0,s.kt)("p",null,"C stores the reply in its local channel data in the content of the content that the reply is for."),(0,s.kt)("p",null," C present the reply to User C when he browses the channel in the context of the status update or the reply that this reply is about."),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"premium-content-items-publishing-via-channels"},"Premium Content Items Publishing via Channels"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"User A creates a premium content item on his client and publishes its id in a status update channel.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"User B receives the update and choose to purchase the item. He pays for it and Client B downloads it from A. User B experiences the item on Client B."))),(0,s.kt)("p",null,"For additional details see ",(0,s.kt)("a",{parentName:"p",href:"/docs/features/paid_content/design"},"premium content publishing")),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"status-update-channels-discovery"},"Status Update Channels Discovery"),(0,s.kt)("h3",{id:"preliminaries"},"Preliminaries"),(0,s.kt)("p",null,"Users who wish to discover and subscribe to public feeds published by A need to know IKA - A's public identity.\n..."),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"receiving-status-updates"},"Receiving Status Updates"),(0,s.kt)("p",null,"Status updates are received by clients using the generic ",(0,s.kt)("a",{parentName:"p",href:"/docs/unp/receiving_msgs"},"receive messages algorithm"),". The content of the received message in this case is a status update from A."),(0,s.kt)("p",null,"Providers don't have any meta-data about a status update they forward to a client besides that the update is some data designated to be accessed by a client they provide a service for."),(0,s.kt)("p",null,"B associates each received status update with its client feed. For example, a status update message form A is associated with the Client B notion of the feed(s) which are configured to display status updates from A."),(0,s.kt)("hr",null))}p.isMDXComponent=!0}}]);